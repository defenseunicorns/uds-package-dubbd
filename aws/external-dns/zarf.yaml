# yaml-language-server: $schema=https://raw.githubusercontent.com/defenseunicorns/zarf/main/zarf.schema.json
kind: ZarfPackageConfig
metadata:
  name: dubbd-aws-external-dns-helm-chart
  description: "Defense Unicorns Big Bang Distro - External DNS Helm Chart"
  # x-release-please-start-version
  version: "0.10.1"
  # x-release-please-end
  url: https://github.com/kubernetes-sigs/external-dns
  # Big Bang / Iron Bank are only amd64
  architecture: amd64

variables:
  - name: DOMAIN
    description: "Name of domain to use for either the tenant only or tenant + admin DNS zone(s)"
    default: "bigbang.dev"
  - name: ADMIN_DOMAIN
    description: "Name of domain to use for the admin DNS zone"
  - name: ROUTE53_ROLE_ARN
    description: "ROUTE53_ROLE_ARN"

components:
  - name: set-external-dns-domain
    required: true
    actions:
      onDeploy:
        before:
          - cmd: |
              if [ -z "${ZARF_VAR_ADMIN_DOMAIN}" ]; then
                echo "\"${ZARF_VAR_DOMAIN}\""
              else
                echo "${ZARF_VAR_DOMAIN}\", \"${ZARF_VAR_ADMIN_DOMAIN}"
              fi
            description: "Set external-dns domain list Zarf variable"
            mute: true
            setVariables:
              - name: DOMAIN_LIST
  - name: external-dns-k8s-manifests
    required: true
    manifests:
      - name: k8s-manifests
        files:
          - ../k8s-manifests/aws-external-dns-ns.yaml
  - name: external-dns-chart
    required: true
    charts:
      # https://artifacthub.io/packages/helm/external-dns/external-dns
      # renovate: datasource=helm
      - name: external-dns
        url: https://kubernetes-sigs.github.io/external-dns
        version: 1.13.1
        namespace: external-dns
        releaseName: external-dns
        valuesFiles:
          - ../values/aws-external-dns.yaml
    images:
      # renovate: datasource=docker
      - "registry1.dso.mil/ironbank/external-dns:v0.13.4"
